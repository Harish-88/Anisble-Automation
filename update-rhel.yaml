---
- name: Update RHEL 9 servers
  hosts: 10.12.50.157
  become: true
  become_user: ansibleusr1
  gather_facts: true

  tasks:
    - name: Perform a full system update using dnf
      ansible.builtin.dnf:
        name: "*"
        state: latest
        update_cache: yes
      register: dnf_update_results

    - name: Display update results
      ansible.builtin.debug:
        var: dnf_update_results

    - name: Reboot if required by the update
      ansible.builtin.reboot:
      when: dnf_update_results.reboot_required is defined and dnf_update_results.reboot_required
